<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAR Demo with Hand Tracking</title>

    <!-- Include A-Frame and AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    
    <!-- MediaPipe Hand Tracking -->
    <script src="https://cdn.jsdelivr.net/gh/google/mediapipe/mediapipe/handtracking/handtracking.js"></script>

    <style>
        /* Instructions UI */
        #instructions {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 8px;
            font-family: sans-serif;
            font-size: 14px;
            z-index: 999;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">

    <!-- Instructions UI -->
    <div id="instructions">
        âœ… Point your hand to make the 3D object appear.<br />
        ðŸ–± Click on the object to interact!
    </div>

    <a-scene embedded arjs="trackingMethod: best; debugUIEnabled: true;">
        <!-- Marker or 3D object -->
        <a-entity id="hand-entity" visible="false" position="0 0 0">
            <!-- 3D object (box) that will appear when hand is detected -->
            <a-box color="tomato" position="0 0 0" scale="0.2 0.2 0.2"></a-box>
        </a-entity>

        <!-- Camera setup -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Initialize MediaPipe Hand Tracking
        const handTracking = new HandTracking.Hands({
            locateFile: (file) => `https://cdn.jsdelivr.net/gh/google/mediapipe/mediapipe/${file}`
        });

        handTracking.setOptions({
            maxNumHands: 1,  // Track one hand at a time
            modelComplexity: 1, // Simplified model for faster detection
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        // Detect hand and trigger 3D object appearance
        handTracking.onResults((results) => {
            const handEntity = document.querySelector("#hand-entity");
            if (results.multiHandLandmarks.length > 0) {
                // Hand is detected, make the object visible
                handEntity.setAttribute("visible", "true");
                const handPosition = results.multiHandLandmarks[0][9]; // Index of wrist landmark
                handEntity.setAttribute("position", `${handPosition.x} ${handPosition.y} -1`);
            } else {
                // No hand detected, hide the object
                handEntity.setAttribute("visible", "false");
            }
        });

        // Start MediaPipe Hand Tracking
        const videoElement = document.createElement("video");
        videoElement.width = 640;
        videoElement.height = 480;
        videoElement.style.position = "absolute";
        videoElement.style.top = "0";
        videoElement.style.left = "0";
        document.body.appendChild(videoElement);

        const camera = new Camera(videoElement, {
            onFrame: async () => {
                await handTracking.send({ image: videoElement });
            },
        });
        camera.start();
    </script>

</body>
</html>
